"use strict";const e=require("../../common/vendor.js"),a=require("../../utils/useSafeArea.js"),t=require("../../utils/prefs.js"),l=require("../../utils/navigation.js");Math||o();const o=()=>"../../components/AppNavBar.js",u={__name:"index",setup(o){const{safeBottom:u}=a.useSafeArea(),c=e.ref(t.getLastMode?t.getLastMode():"basic"),i=e.ref("jqk-11-12-13"),n=e.ref("regular"),r=e.ref(50),v=e.ref(!0),s=e.ref(!0),d=e.ref(!1),f=[{value:"basic",label:"基础模式（点选）"},{value:"pro",label:"专业模式（拖拽）"}],m=[{value:"jqk-1",label:"JQK 记作 1"},{value:"jqk-11-12-13",label:"JQK 记作 11/12/13"}],h=[{value:"regular",label:"常规题库"},{value:"mistakes",label:"错题本"},{value:"mix",label:"混合"}],x=e.computed((()=>({paddingBottom:`${Math.max(24,(u.value||0)+24)}px`}))),p=e.computed((()=>[{key:"haptics",title:"振动反馈",desc:"答题提示或失败时震动提醒",checked:v.value},{key:"sfx",title:"音效提示",desc:"保留关键操作音效",checked:s.value},{key:"reducedMotion",title:"低性能模式",desc:"减少动画效果以提升流畅度",checked:d.value}]));function y(a=!1){const l=t.getGameplayPrefs();if(c.value=t.getLastMode?t.getLastMode():c.value,i.value=l.rankMode,n.value=l.deckSource,r.value=l.mixWeight,v.value=!!l.haptics,s.value=!!l.sfx,d.value=!!l.reducedMotion,a&&l.rankMigrationNotice){try{e.index.showToast({title:"已迁移到新规则：JQK 仅支持 1 或 11/12/13",icon:"none",duration:2500})}catch(o){}t.consumeRankMigrationNotice()}}function g(a){var l,o;const u="pro"===((null==(l=null==a?void 0:a.detail)?void 0:l.value)??(null==(o=null==a?void 0:a.target)?void 0:o.value)??"")?"pro":"basic";c.value!==u&&(c.value=u);try{t.setLastMode(u)}catch(i){}try{"function"==typeof e.index.$emit&&e.index.$emit("tf24:mode-changed",u)}catch(i){}try{e.index.showToast({title:"pro"===u?"已切换为专业模式":"已切换为基础模式",icon:"none",duration:1600})}catch(i){}}function k(e){var a;const l=(null==(a=null==e?void 0:e.detail)?void 0:a.value)||"jqk-11-12-13";i.value=l,t.setGameplayPrefs({rankMode:l})}function b(e){var a;const l=(null==(a=null==e?void 0:e.detail)?void 0:a.value)||"regular";n.value=l,t.setGameplayPrefs({deckSource:l})}function _(e){var a;const l=Number(null==(a=null==e?void 0:e.detail)?void 0:a.value);Number.isFinite(l)&&(r.value=Math.min(100,Math.max(0,Math.round(l))),t.setGameplayPrefs({mixWeight:r.value}))}function M(){try{e.index.showModal({title:"清理缓存",content:"将清除当前牌局缓存，保留用户与统计数据。",confirmText:"立即清理",cancelText:"取消",success:a=>{if(a.confirm){try{e.index.removeStorageSync("tf24_game_session_v1")}catch(t){}try{e.index.removeStorageSync("__tf24_tab_cache__")}catch(t){}try{e.index.showToast({title:"缓存已清理",icon:"success"})}catch(t){}}}})}catch(a){try{e.index.removeStorageSync("tf24_game_session_v1")}catch(t){}try{e.index.removeStorageSync("__tf24_tab_cache__")}catch(t){}}}return e.onBackPress((()=>(l.navigateToHome(),!0))),e.onMounted((()=>{y(!0)})),e.onShow((()=>{y(!1)})),(a,l)=>e.e({a:e.p({title:"设置","show-back":!0,"back-to-index":!0}),b:e.f(f,((a,t,l)=>({a:a.value,b:c.value===a.value,c:e.t(a.label),d:a.value}))),c:e.o(g),d:c.value,e:e.f(m,((a,t,l)=>({a:a.value,b:i.value===a.value,c:e.t(a.label),d:a.value}))),f:e.o(k),g:i.value,h:e.f(h,((a,t,l)=>({a:a.value,b:n.value===a.value,c:e.t(a.label),d:a.value}))),i:e.o(b),j:n.value,k:"mix"===n.value},"mix"===n.value?{l:e.t(r.value),m:r.value,n:e.o(_)}:{},{o:e.f(p.value,((a,l,o)=>({a:e.t(a.title),b:e.t(a.desc),c:a.checked,d:e.o((e=>{return l=a.key,o=e.detail.value,"haptics"===l&&(v.value=!!o),"sfx"===l&&(s.value=!!o),"reducedMotion"===l&&(d.value=!!o),void t.setGameplayPrefs({haptics:v.value,sfx:s.value,reducedMotion:d.value});var l,o}),a.key),e:a.key}))),p:e.o(M),q:e.s(x.value)})}},c=e._export_sfc(u,[["__scopeId","data-v-a9431275"]]);wx.createPage(c);
