"use strict";const t=require("../common/vendor.js");function e(){return function(t){const e=t&&"object"==typeof t?{...t}:{};return e&&"object"==typeof e?("pro"!==e.lastMode&&"basic"!==e.lastMode&&(e.lastMode="basic"),Number.isFinite(e.lastHintTs)||(e.lastHintTs=0),e.avatarMeta&&"object"==typeof e.avatarMeta||(e.avatarMeta={}),e):{}}(function(){try{const n=t.index.getStorageSync("tf24_prefs_v1");if(!n)return{};if("string"==typeof n)try{return JSON.parse(n)||{}}catch(e){return{}}return n&&"object"==typeof n?n:{}}catch(e){return{}}}())}function n(n){const r=e(),a="function"==typeof n?n(r):{...r,...n||{}};return function(e){try{t.index.setStorageSync("tf24_prefs_v1",JSON.stringify(e||{}))}catch(n){}}(a),a}function r(t,e){t&&n((n=>{const r={...n.avatarMeta||{}};return e&&e.uri?r[t]={uri:e.uri,lastModified:Number.isFinite(e.lastModified)?e.lastModified:Date.now()}:delete r[t],{...n,avatarMeta:r}}))}exports.clearAvatarMeta=function(t){r(t,null)},exports.getLastHintTimestamp=function(){const t=e();return Number.isFinite(t.lastHintTs)?t.lastHintTs:0},exports.getLastMode=function(){return"pro"===e().lastMode?"pro":"basic"},exports.setLastHintTimestamp=function(t){const e=Number.isFinite(t)?Math.max(0,Math.floor(t)):Date.now();n((t=>({...t,lastHintTs:e})))},exports.setLastMode=function(t){n((e=>({...e,lastMode:"pro"===t?"pro":"basic"})))},exports.writeAvatarMeta=r;
