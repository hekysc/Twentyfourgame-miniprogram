"use strict";const t=require("./store.js"),e="__tf24_tab_cache__";function a(){try{const t=getApp({allowDefault:!0});if(t)return t.globalData=t.globalData||{},t.globalData[e]=t.globalData[e]||{warmedAt:0,usersState:null,overviewRows:null,statsExt:{},tabBarHeight:0},t.globalData[e]}catch(t){}return"undefined"!=typeof globalThis?(globalThis.__tf24TabCache=globalThis.__tf24TabCache||{warmedAt:0,usersState:null,overviewRows:null,statsExt:{},tabBarHeight:0},globalThis.__tf24TabCache):{warmedAt:0,usersState:null,overviewRows:null,statsExt:{},tabBarHeight:0}}function s(t){return t&&"object"==typeof t?{currentId:t.currentId||"",list:Array.isArray(t.list)?t.list.map((t=>({...t}))):[]}:null}function r(t){return Array.isArray(t)?t.map((t=>({...t}))):null}function o(t){if(!t||"object"!=typeof t)return{};const e={};for(const a of Object.keys(t)){const s=t[a];s&&"object"==typeof s&&(e[a]={totals:s.totals?{...s.totals}:{total:0,success:0,fail:0},days:s.days?{...s.days}:{},rounds:Array.isArray(s.rounds)?s.rounds.map((t=>({...t}))):[],agg:s.agg?{...s.agg}:{}})}return e}exports.getCachedOverviewRows=function(){return r(a().overviewRows)},exports.getCachedStatsExt=function(t){if(!t)return null;const e=a(),s=e.statsExt&&e.statsExt[t];return s&&o({[t]:s})[t]||null},exports.getCachedUsersState=function(){return s(a().usersState)},exports.getTabBarHeight=function(){const t=a();return Number.isFinite(t.tabBarHeight)?t.tabBarHeight:0},exports.mergeCachedStatsExt=function(t){const e=a(),s=o(t);e.statsExt={...e.statsExt||{},...s},e.warmedAt=Date.now()},exports.scheduleTabWarmup=function(e={}){const{immediate:n=!1,delay:i=120}=e||{},c=()=>{try{!function(){const e=a();try{t.ensureInit()}catch(l){}let n=null;try{n=t.getUsers()}catch(l){n={list:[],currentId:""}}let i=null;try{i=t.allUsersWithStats()}catch(l){i=[]}const c={};try{for(const e of i||[])if(e&&e.id)try{c[e.id]=t.readStatsExtended(e.id)}catch(l){c[e.id]={totals:{total:0,success:0,fail:0},days:{},rounds:[],agg:{}}}}catch(l){}e.usersState=s(n)||{list:[],currentId:""},e.overviewRows=r(i)||[],e.statsExt=o(c),e.warmedAt=Date.now()}()}catch(e){}};if(n)c();else{try{if("function"==typeof requestIdleCallback)return void requestIdleCallback(c,{timeout:500})}catch(l){}setTimeout(c,Number.isFinite(i)?Math.max(16,i):120)}},exports.setCachedOverviewRows=function(t){const e=a();e.overviewRows=r(t)||[],e.warmedAt=Date.now()},exports.setCachedUsersState=function(t){const e=a();e.usersState=s(t)||{list:[],currentId:""},e.warmedAt=Date.now()},exports.setTabBarHeight=function(t){if(!Number.isFinite(t)||t<=0)return;const e=a();e.tabBarHeight!==t&&(e.tabBarHeight=t)};
