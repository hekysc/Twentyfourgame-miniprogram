"use strict";function t(t,e){return 1===t?1:11===t||12===t||13===t?e?t:1:t}function e(t){if(!t)return"";const e="number"==typeof t.n?t.n:0,r="number"==typeof t.d?t.d:1;return 1===r?String(e):`${e}/${r}`}function r(t){if(!t)return"";let e=t.trim();for(;e.startsWith("(")&&e.endsWith(")");){let t=0,r=!0;for(let n=0;n<e.length;n++){const o=e[n];if("("===o)t++;else if(")"===o){if(t--,t<0){r=!1;break}if(0===t&&n<e.length-1){r=!1;break}}}if(!r||0!==t)break;e=e.slice(1,-1).trim()}return e}function n(t){if(!Number.isFinite(t))return"-";if(t<1e3)return`${t}ms`;const e=t/1e3;if(e<60)return`${e.toFixed(1)}s`;return`${Math.floor(e/60)}m${Math.round(e%60)}s`}exports.computeExprStats=function(t){const e=t||[],r=[];let n=0,o=0;for(const u of e)if("op"===u.type){if("("===u.value){n+=1,n>o&&(o=n);continue}if(")"===u.value){n=Math.max(0,n-1);continue}"+"!==u.value&&"-"!==u.value&&"×"!==u.value&&"÷"!==u.value||r.push(u.value)}return{exprLen:e.length,maxDepth:o,ops:r}},exports.createShuffledDeck=function(){const t=["S","H","D","C"],e=[];for(const r of t)for(let t=1;t<=13;t++)e.push({rank:t,suit:r});for(let r=e.length-1;r>0;r--){const t=Math.floor(Math.random()*(r+1));[e[r],e[t]]=[e[t],e[r]]}return e},exports.formatExpressionWithValue=function(t,n){const o=r(t||"");if(!o)return"";const u=n?e(n):"";return u?`${o}=${u}`:o},exports.formatFractionValue=e,exports.formatMs=n,exports.formatMsShort=function(t){if(!Number.isFinite(t))return"-";const e=t/1e3;return e<120?`${e.toFixed(1)}s`:n(t)},exports.isExpressionComplete=function(t){const e=t||[];if(!e.length)return!1;let r=0,n=null;const o=t=>"+"===t||"-"===t||"×"===t||"÷"===t;for(const i of e){if("op"===i.type&&"("===i.value)r+=1;else if("op"===i.type&&")"===i.value&&(r-=1,r<0))return!1;if(n){const t="op"===n.type?n.value:"num",e="op"===i.type?i.value:"num";if(o(t)&&o(e))return!1;if("num"===n.type&&"op"===i.type&&"("===i.value)return!1;if("op"===n.type&&")"===n.value&&"num"===i.type)return!1;if("num"===n.type&&"num"===i.type)return!1}else if("op"===i.type&&(")"===i.value||o(i.value)))return!1;n=i}const u=e[e.length-1];return(!u||"op"!==u.type||"("!==u.value&&!o(u.value))&&0===r},exports.labelForRank=function(t){return 1===t?"A":11===t?"J":12===t?"Q":13===t?"K":String(t)},exports.mapCardRank=t,exports.operateFractions=function(t,e,r){if(!t||!e)return null;if("+"===r)return t.plus(e);if("-"===r)return t.minus(e);if("×"===r)return t.times(e);if("÷"===r){if(0===e.n)throw new Error("divide-by-zero");return t.div(e)}return null},exports.statsFromExpressionString=function(t){if(!t)return{ops:[],exprLen:0,maxDepth:0};const e=[];let r=0,n=0,o=0;const u=t.match(/10|11|12|13|[1-9]|[()+\-×÷]/g)||[];for(const i of u)r+=1,"("===i?(n+=1,n>o&&(o=n)):")"===i?n=Math.max(0,n-1):"+-×÷".includes(i)&&e.push(i);return{ops:e,exprLen:r,maxDepth:o}},exports.stripOuterParens=r,exports.tokensToExpression=function(e,r){return(e||[]).map((e=>{if("num"===e.type){const n="number"==typeof e.rank?e.rank:Number(e.value);return String(t(n,r))}return e.value||""})).join("")};
